$(function(){$.fn.extend({trigSearch:function(n){var c={},h={kwContainer:$("#search-kw"),toPage:1,rowSize:10,tbody:$("#result-container"),emptyRow:$("#row-prototype > tr"),replaceBtn:".replace-exam",delBtn:".del-exam",initRow:$("#row-init"),initNo:0,paginationWrap:$("#pagination"),pagination:$("#pagination .pagination"),btns:$(".pagination-src li")},p={},q={};$.extend(c,h,n);$.extend(q,{keyword:c.keyword,toPage:c.toPage,rowSize:c.rowSize});return $(this).each(function(n,r){function e(){var b=this; b.fetchData=function(a){$.ajax({url:"data/examSearchResult1.php",dataType:"json",async:!1,data:a,complete:function(a){var c=a.responseJSON.dataObj;if(c&&0!=c.length)return $.extend(p,a.responseJSON);alert(findNothing);return!1}});return p};b.appendData=function(a,b){var d=c.tbody,k=c.initNo;c.initRow.hide();c.tbody.html(" ");$.each(a,function(l,b){var f=c.emptyRow.clone(),t=a[l].desc,g=a[l].date,s=$(c.delBtn,f),e=$(c.replaceBtn,f),m=$("td",f),h;k++;h=k;m.eq(0).html(h);m.eq(1).html(l);m.eq(2).html(t); m.eq(3).html(g);s.attr("eid",l);e.attr("eid",l);f.appendTo(d)});b()};b.bindBtn=function(a){var b=a.find(c.delBtn),d=a.find(c.replaceBtn);a.rowAccess();apiRA=a.data("rowAccess");b.each(function(a,c){var b=$(c),f=b.parent().parent();b.modalInit({confirmCallback:function(){$.ajax({url:"data/2101.php",data:{id:b.attr("eid")},type:"post",success:function(a){1==a?apiRA.markRow(f,function(){b.parent().html("")}):alert(""==a?"\u522a\u9664\u4e0d\u6210\u529f":a)},error:function(a){console.log("error error")}, complete:function(a){404==a.status&&alert("\u7121\u6cd5\u9023\u7d50\u4f3a\u670d\u5668")}})}})});d.each(function(a,c){$(c).modalInit({modalContainer:"#replace-container",cancelBtn:"#replace-cancel",confirmBtn:"#replace-confirm",openCallback:function(){var a=$("#replace-exam-id"),b=$(c).attr("eid"),d=$("#replace-exam-file"),g=$('<input type="file" name="exam-file" id="replace-exam-file">');a.val(b);d.remove();g.insertBefore(a)}})})};b.setPagination=function(a){var b=c.pagination,d=c.btns,k=d.eq(0), l=d.eq(1),d=d.eq(2),h=a.current,f=a.startPage,e=a.startPage+a.pagesLength-1;a=a.finalPage;var g=f;b.html(" ");for(0!=f-1&&k.clone().trigSearch({toPage:f-1}).appendTo(b);g<=e;)k=l.clone(),k.find("a").text(g).end().appendTo(b),g==h&&k.addClass("active"),k.trigSearch({toPage:g}),g++;e<a&&d.clone().trigSearch({toPage:e+1}).appendTo(b)};b.init=function(){h.click(function(){var a=b.fetchData($.extend(q,{keyword:c.kwContainer.val()}));b.appendData(a.dataObj,function(){b.bindBtn(c.tbody);b.setPagination(a.pagination)})})}} var h=$(r),e=new e;$(r).data("trigSearch",e);e.init()})}});$("#go-search").trigSearch()});